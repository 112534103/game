<!doctype html>
<html lang="zh-TW">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¿«é€Ÿæ‰¾äººèŠ</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    .contact-card {
      transition: all 0.3s ease;
    }
    
    .contact-card:hover {
      transform: translateY(-2px);
    }
    
    .priority-high {
      border-left: 4px solid #ef4444;
    }
    
    .priority-medium {
      border-left: 4px solid #f59e0b;
    }
    
    .priority-low {
      border-left: 4px solid #10b981;
    }
    
    .loading-spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #3b82f6;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      animation: slideIn 0.3s ease;
      z-index: 1000;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full">
  <div id="app" class="min-h-full p-6" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
   <div class="max-w-4xl mx-auto"><!-- Header -->
    <div class="text-center mb-8">
     <h1 id="app-title" class="text-4xl font-bold mb-2" style="color: #ffffff;">ğŸ’¬ å¿«é€Ÿæ‰¾äººèŠ</h1>
     <p class="text-lg" style="color: #e0e7ff;">éš¨æ™‚è¨˜éŒ„ã€ç«‹å³è¯çµ¡</p>
    </div><!-- Add Contact Form -->
    <div class="rounded-2xl p-6 mb-6 shadow-lg" style="background-color: #ffffff;">
     <h2 class="text-xl font-bold mb-4" style="color: #667eea;">æ–°å¢æƒ³èŠçš„äºº</h2>
     <form id="add-contact-form">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
       <div><label for="person-name" class="block text-sm font-medium mb-2" style="color: #4b5563;">å°æ–¹åå­—</label> <input type="text" id="person-name" required class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-purple-500" style="border-color: #e5e7eb; background-color: #f9fafb;" placeholder="ä¾‹å¦‚ï¼šå°æ˜ã€åŒäº‹ç‹å§">
       </div>
       <div><label for="contact-method" class="block text-sm font-medium mb-2" style="color: #4b5563;">è¯çµ¡æ–¹å¼</label> <input type="text" id="contact-method" required class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-purple-500" style="border-color: #e5e7eb; background-color: #f9fafb;" placeholder="ä¾‹å¦‚ï¼šLINEã€é›»è©±ã€å¾®ä¿¡">
       </div>
      </div>
      <div class="mb-4"><label for="topic" class="block text-sm font-medium mb-2" style="color: #4b5563;">æƒ³è¨è«–çš„è©±é¡Œ</label> <textarea id="topic" required rows="2" class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-purple-500" style="border-color: #e5e7eb; background-color: #f9fafb;" placeholder="ä¾‹å¦‚ï¼šè¨è«–å°ˆæ¡ˆé€²åº¦ã€ç´„åƒé£¯æ™‚é–“"></textarea>
      </div>
      <div class="mb-4"><label for="priority" class="block text-sm font-medium mb-2" style="color: #4b5563;">é‡è¦ç¨‹åº¦</label> <select id="priority" class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-purple-500" style="border-color: #e5e7eb; background-color: #f9fafb;"> <option value="high">ğŸ”´ å¾ˆæ€¥</option> <option value="medium" selected>ğŸŸ¡ ä¸€èˆ¬</option> <option value="low">ğŸŸ¢ ä¸æ€¥</option> </select>
      </div><button type="submit" id="add-button" class="w-full py-3 rounded-lg font-bold text-white transition-all" style="background-color: #667eea;"> â• æ–°å¢è¯çµ¡äºº </button>
     </form>
    </div><!-- Contact List -->
    <div class="space-y-4" id="contact-list"><!-- Contacts will be rendered here -->
    </div><!-- Empty State -->
    <div id="empty-state" class="text-center py-12 rounded-2xl" style="background-color: rgba(255, 255, 255, 0.2);">
     <div class="text-6xl mb-4">
      ğŸ“­
     </div>
     <p id="empty-message" class="text-xl font-medium" style="color: #ffffff;">ç›®å‰æ²’æœ‰å¾…èŠçš„äººï¼Œæ–°å¢ä¸€å€‹å§ï¼</p>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      app_title: "ğŸ’¬ å¿«é€Ÿæ‰¾äººèŠ",
      add_button_text: "â• æ–°å¢è¯çµ¡äºº",
      empty_message: "ç›®å‰æ²’æœ‰å¾…èŠçš„äººï¼Œæ–°å¢ä¸€å€‹å§ï¼",
      primary_color: "#667eea",
      secondary_color: "#ffffff",
      text_color: "#1f2937",
      card_color: "#f9fafb",
      accent_color: "#764ba2",
      font_family: "system-ui, -apple-system, sans-serif",
      font_size: 16
    };

    let contactsData = [];

    const dataHandler = {
      onDataChanged(data) {
        contactsData = data.sort((a, b) => {
          const priorityOrder = { high: 0, medium: 1, low: 2 };
          if (a.contacted !== b.contacted) return a.contacted ? 1 : -1;
          return priorityOrder[a.priority] - priorityOrder[b.priority];
        });
        renderContacts();
      }
    };

    async function onConfigChange(config) {
      const baseFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const customFont = `${baseFont}, ${baseFontStack}`;
      const baseSize = config.font_size || defaultConfig.font_size;
      
      document.body.style.fontFamily = customFont;
      
      const appElement = document.getElementById('app');
      appElement.style.background = `linear-gradient(135deg, ${config.primary_color || defaultConfig.primary_color} 0%, ${config.accent_color || defaultConfig.accent_color} 100%)`;
      
      const appTitle = document.getElementById('app-title');
      appTitle.textContent = config.app_title || defaultConfig.app_title;
      appTitle.style.fontSize = `${baseSize * 2}px`;
      appTitle.style.color = config.secondary_color || defaultConfig.secondary_color;
      
      const addButton = document.getElementById('add-button');
      addButton.textContent = config.add_button_text || defaultConfig.add_button_text;
      addButton.style.backgroundColor = config.primary_color || defaultConfig.primary_color;
      addButton.style.fontSize = `${baseSize}px`;
      
      const emptyMessage = document.getElementById('empty-message');
      emptyMessage.textContent = config.empty_message || defaultConfig.empty_message;
      emptyMessage.style.fontSize = `${baseSize * 1.25}px`;
      emptyMessage.style.color = config.secondary_color || defaultConfig.secondary_color;
      
      document.querySelectorAll('.contact-card').forEach(card => {
        card.style.backgroundColor = config.card_color || defaultConfig.card_color;
      });
    }

    function renderContacts() {
      const listContainer = document.getElementById('contact-list');
      const emptyState = document.getElementById('empty-state');
      
      if (contactsData.length === 0) {
        listContainer.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }
      
      emptyState.style.display = 'none';
      
      const existingCards = new Map(
        [...listContainer.children].map(el => [el.dataset.contactId, el])
      );
      
      const currentIds = new Set();
      
      contactsData.forEach(contact => {
        currentIds.add(contact.__backendId);
        
        if (existingCards.has(contact.__backendId)) {
          updateContactCard(existingCards.get(contact.__backendId), contact);
          existingCards.delete(contact.__backendId);
        } else {
          listContainer.appendChild(createContactCard(contact));
        }
      });
      
      existingCards.forEach(el => el.remove());
    }

    function createContactCard(contact) {
      const card = document.createElement('div');
      card.dataset.contactId = contact.__backendId;
      card.className = `contact-card rounded-2xl p-6 shadow-lg priority-${contact.priority}`;
      card.style.backgroundColor = window.elementSdk?.config.card_color || defaultConfig.card_color;
      
      updateContactCard(card, contact);
      return card;
    }

    function updateContactCard(cardElement, contact) {
      const priorityEmoji = { high: 'ğŸ”´', medium: 'ğŸŸ¡', low: 'ğŸŸ¢' };
      const priorityText = { high: 'å¾ˆæ€¥', medium: 'ä¸€èˆ¬', low: 'ä¸æ€¥' };
      
      cardElement.className = `contact-card rounded-2xl p-6 shadow-lg priority-${contact.priority} ${contact.contacted ? 'opacity-60' : ''}`;
      cardElement.style.backgroundColor = window.elementSdk?.config.card_color || defaultConfig.card_color;
      
      cardElement.innerHTML = `
        <div class="flex justify-between items-start mb-3">
          <div class="flex-1">
            <h3 class="text-2xl font-bold mb-1" style="color: ${window.elementSdk?.config.text_color || defaultConfig.text_color};">
              ${contact.contacted ? 'âœ… ' : ''}${contact.person_name}
            </h3>
            <p class="text-sm" style="color: #6b7280;">
              ${priorityEmoji[contact.priority]} ${priorityText[contact.priority]} | ğŸ“± ${contact.contact_method}
            </p>
          </div>
        </div>
        
        <div class="mb-4 p-3 rounded-lg" style="background-color: #f3f4f6;">
          <p class="text-base" style="color: ${window.elementSdk?.config.text_color || defaultConfig.text_color};">
            ğŸ’­ ${contact.topic}
          </p>
        </div>
        
        <div class="flex gap-2">
          ${!contact.contacted ? `
            <button 
              class="contact-btn flex-1 py-2 px-4 rounded-lg font-bold text-white transition-all"
              style="background-color: ${window.elementSdk?.config.primary_color || defaultConfig.primary_color};"
              data-action="contact"
              data-id="${contact.__backendId}"
            >
              ğŸ“ ç«‹å³è¯çµ¡
            </button>
          ` : `
            <button 
              class="undo-btn flex-1 py-2 px-4 rounded-lg font-bold transition-all"
              style="background-color: #e5e7eb; color: #6b7280;"
              data-action="undo"
              data-id="${contact.__backendId}"
            >
              â†©ï¸ æ¨™è¨˜æœªè¯çµ¡
            </button>
          `}
          <button 
            class="delete-btn py-2 px-4 rounded-lg font-bold text-white transition-all"
            style="background-color: #ef4444;"
            data-action="delete"
            data-id="${contact.__backendId}"
          >
            ğŸ—‘ï¸
          </button>
        </div>
      `;
      
      return cardElement;
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.style.backgroundColor = type === 'success' ? '#10b981' : '#ef4444';
      toast.style.color = '#ffffff';
      toast.textContent = message;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    function showLoading(button) {
      button.disabled = true;
      button.style.opacity = '0.7';
      const originalText = button.textContent;
      button.innerHTML = '<div class="loading-spinner mx-auto"></div>';
      return originalText;
    }

    function hideLoading(button, originalText) {
      button.disabled = false;
      button.style.opacity = '1';
      button.textContent = originalText;
    }

    document.getElementById('add-contact-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (contactsData.length >= 999) {
        showToast('å·²é”åˆ° 999 ç­†ä¸Šé™ï¼Œè«‹å…ˆåˆªé™¤ä¸€äº›è¯çµ¡äºº', 'error');
        return;
      }
      
      const submitButton = e.target.querySelector('button[type="submit"]');
      const originalText = showLoading(submitButton);
      
      const newContact = {
        id: Date.now().toString(),
        person_name: document.getElementById('person-name').value,
        topic: document.getElementById('topic').value,
        contact_method: document.getElementById('contact-method').value,
        priority: document.getElementById('priority').value,
        created_at: new Date().toISOString(),
        contacted: false
      };
      
      const result = await window.dataSdk.create(newContact);
      
      hideLoading(submitButton, originalText);
      
      if (result.isOk) {
        e.target.reset();
        showToast('âœ… å·²æ–°å¢è¯çµ¡äºº');
      } else {
        showToast('âŒ æ–°å¢å¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡', 'error');
      }
    });

    document.getElementById('contact-list').addEventListener('click', async (e) => {
      const button = e.target.closest('button');
      if (!button) return;
      
      const action = button.dataset.action;
      const contactId = button.dataset.id;
      const contact = contactsData.find(c => c.__backendId === contactId);
      
      if (!contact) return;
      
      if (action === 'delete') {
        const confirmButton = document.createElement('button');
        confirmButton.textContent = 'ç¢ºèªåˆªé™¤ï¼Ÿ';
        confirmButton.className = button.className;
        confirmButton.style.backgroundColor = '#dc2626';
        
        const cancelButton = document.createElement('button');
        cancelButton.textContent = 'å–æ¶ˆ';
        cancelButton.className = 'py-2 px-4 rounded-lg font-bold transition-all';
        cancelButton.style.backgroundColor = '#6b7280';
        cancelButton.style.color = '#ffffff';
        
        const buttonContainer = button.parentElement;
        const originalButtons = buttonContainer.innerHTML;
        
        buttonContainer.innerHTML = '';
        buttonContainer.appendChild(confirmButton);
        buttonContainer.appendChild(cancelButton);
        
        const restoreButtons = () => {
          buttonContainer.innerHTML = originalButtons;
        };
        
        confirmButton.addEventListener('click', async () => {
          const originalText = showLoading(confirmButton);
          const result = await window.dataSdk.delete(contact);
          
          if (result.isOk) {
            showToast('ğŸ—‘ï¸ å·²åˆªé™¤è¯çµ¡äºº');
          } else {
            hideLoading(confirmButton, originalText);
            restoreButtons();
            showToast('âŒ åˆªé™¤å¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡', 'error');
          }
        });
        
        cancelButton.addEventListener('click', restoreButtons);
        
      } else if (action === 'contact') {
        const originalText = showLoading(button);
        const result = await window.dataSdk.update({ ...contact, contacted: true });
        
        if (result.isOk) {
          showToast('âœ… å·²æ¨™è¨˜ç‚ºå·²è¯çµ¡');
        } else {
          hideLoading(button, originalText);
          showToast('âŒ æ›´æ–°å¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡', 'error');
        }
        
      } else if (action === 'undo') {
        const originalText = showLoading(button);
        const result = await window.dataSdk.update({ ...contact, contacted: false });
        
        if (result.isOk) {
          showToast('â†©ï¸ å·²æ¨™è¨˜ç‚ºæœªè¯çµ¡');
        } else {
          hideLoading(button, originalText);
          showToast('âŒ æ›´æ–°å¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡', 'error');
        }
      }
    });

    async function init() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        showToast('âŒ åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢', 'error');
        return;
      }
      
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.primary_color || defaultConfig.primary_color,
                set: (value) => {
                  config.primary_color = value;
                  window.elementSdk.setConfig({ primary_color: value });
                }
              },
              {
                get: () => config.secondary_color || defaultConfig.secondary_color,
                set: (value) => {
                  config.secondary_color = value;
                  window.elementSdk.setConfig({ secondary_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.card_color || defaultConfig.card_color,
                set: (value) => {
                  config.card_color = value;
                  window.elementSdk.setConfig({ card_color: value });
                }
              },
              {
                get: () => config.accent_color || defaultConfig.accent_color,
                set: (value) => {
                  config.accent_color = value;
                  window.elementSdk.setConfig({ accent_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ["app_title", config.app_title || defaultConfig.app_title],
            ["add_button_text", config.add_button_text || defaultConfig.add_button_text],
            ["empty_message", config.empty_message || defaultConfig.empty_message]
          ])
        });
      }
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a0dd94ce17f82cd',t:'MTc2MzUzNTgxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>